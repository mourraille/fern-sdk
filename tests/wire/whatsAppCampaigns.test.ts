// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("WhatsAppCampaignsClient", () => {
    test("getWhatsAppCampaigns (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            campaigns: [
                {
                    campaignName: "campaign_22",
                    campaignStatus: "sent",
                    createdAt: "2017-05-01T12:30:00Z",
                    errorReason: "NONE",
                    id: 1672035851100690,
                    invalidatedContacts: 0,
                    modifiedAt: "2017-05-01T12:30:00Z",
                    readPercentage: 28.57,
                    scheduledAt: "2022-12-27T09:50:00Z",
                    stats: { delivered: 3, notSent: 4, read: 2, sent: 3, unsubscribe: 0 },
                    templateId: "templateId",
                },
            ],
            count: 23,
        };
        server.mockEndpoint().get("/whatsappCampaigns").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.whatsAppCampaigns.getWhatsAppCampaigns();
        expect(response).toEqual({
            campaigns: [
                {
                    campaignName: "campaign_22",
                    campaignStatus: "sent",
                    createdAt: "2017-05-01T12:30:00Z",
                    errorReason: "NONE",
                    id: 1672035851100690,
                    invalidatedContacts: 0,
                    modifiedAt: "2017-05-01T12:30:00Z",
                    readPercentage: 28.57,
                    scheduledAt: "2022-12-27T09:50:00Z",
                    stats: {
                        delivered: 3,
                        notSent: 4,
                        read: 2,
                        sent: 3,
                        unsubscribe: 0,
                    },
                    templateId: "templateId",
                },
            ],
            count: 23,
        });
    });

    test("getWhatsAppCampaigns (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/whatsappCampaigns").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.whatsAppCampaigns.getWhatsAppCampaigns();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("createWhatsAppCampaign (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            name: "Test Campaign",
            recipients: {},
            scheduledAt: "2017-06-01T12:30:00+02:00",
            templateId: 19,
        };
        const rawResponseBody = { id: 5 };
        server
            .mockEndpoint()
            .post("/whatsappCampaigns")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.whatsAppCampaigns.createWhatsAppCampaign({
            name: "Test Campaign",
            recipients: {},
            scheduledAt: "2017-06-01T12:30:00+02:00",
            templateId: 19,
        });
        expect(response).toEqual({
            id: 5,
        });
    });

    test("createWhatsAppCampaign (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "name", recipients: {}, scheduledAt: "scheduledAt", templateId: 1 };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/whatsappCampaigns")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.createWhatsAppCampaign({
                name: "name",
                recipients: {},
                scheduledAt: "scheduledAt",
                templateId: 1,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getWhatsAppConfig (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            businessStatus: "verified",
            phoneNumberNameStatus: "APPROVED",
            phoneNumberQuality: "GREEN",
            sendingLimit: "TIER_1K",
            whatsappBusinessAccountId: "whatsappBusinessAccountId",
            whatsappBusinessAccountStatus: "APPROVED",
        };
        server
            .mockEndpoint()
            .get("/whatsappCampaigns/config")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.whatsAppCampaigns.getWhatsAppConfig();
        expect(response).toEqual({
            businessStatus: "verified",
            phoneNumberNameStatus: "APPROVED",
            phoneNumberQuality: "GREEN",
            sendingLimit: "TIER_1K",
            whatsappBusinessAccountId: "whatsappBusinessAccountId",
            whatsappBusinessAccountStatus: "APPROVED",
        });
    });

    test("getWhatsAppConfig (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/whatsappCampaigns/config")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.getWhatsAppConfig();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("createWhatsAppTemplate (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            bodyText: "making it look like readable English",
            category: "MARKETING",
            language: "en",
            name: "Test template",
        };
        const rawResponseBody = { id: 5 };
        server
            .mockEndpoint()
            .post("/whatsappCampaigns/template")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.whatsAppCampaigns.createWhatsAppTemplate({
            bodyText: "making it look like readable English",
            category: "MARKETING",
            language: "en",
            name: "Test template",
        });
        expect(response).toEqual({
            id: 5,
        });
    });

    test("createWhatsAppTemplate (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { bodyText: "bodyText", category: "MARKETING", language: "language", name: "name" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/whatsappCampaigns/template")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.createWhatsAppTemplate({
                bodyText: "bodyText",
                category: "MARKETING",
                language: "language",
                name: "name",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getWhatsAppTemplates (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            count: 2,
            templates: [
                {
                    category: "MARKETING",
                    createdAt: "2017-05-01T12:30:00Z",
                    errorReason: "NONE",
                    id: 235,
                    language: "en",
                    modifiedAt: "2017-05-01T12:30:00Z",
                    name: "campaign_22",
                    status: "approved",
                },
                {
                    category: "MARKETING",
                    createdAt: "2017-0",
                    errorReason: "NONE",
                    id: 124,
                    language: "",
                    modifiedAt: "2017-05-01T12:30:00Z",
                    name: "test-template",
                    status: "draft",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/whatsappCampaigns/template-list")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.whatsAppCampaigns.getWhatsAppTemplates();
        expect(response).toEqual({
            count: 2,
            templates: [
                {
                    category: "MARKETING",
                    createdAt: "2017-05-01T12:30:00Z",
                    errorReason: "NONE",
                    id: 235,
                    language: "en",
                    modifiedAt: "2017-05-01T12:30:00Z",
                    name: "campaign_22",
                    status: "approved",
                },
                {
                    category: "MARKETING",
                    createdAt: "2017-0",
                    errorReason: "NONE",
                    id: 124,
                    language: "",
                    modifiedAt: "2017-05-01T12:30:00Z",
                    name: "test-template",
                    status: "draft",
                },
            ],
        });
    });

    test("getWhatsAppTemplates (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/whatsappCampaigns/template-list")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.getWhatsAppTemplates();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("sendWhatsAppTemplateApproval (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server
            .mockEndpoint()
            .post("/whatsappCampaigns/template/approval/1000000")
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.whatsAppCampaigns.sendWhatsAppTemplateApproval({
            templateId: 1000000,
        });
        expect(response).toEqual(undefined);
    });

    test("sendWhatsAppTemplateApproval (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/whatsappCampaigns/template/approval/1000000")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.sendWhatsAppTemplateApproval({
                templateId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getWhatsAppCampaign (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            campaignName: "Test WhatsApp Campaign",
            campaignStatus: "sent",
            createdAt: "2022-12-26T06:50:00Z",
            id: 1672035851100690,
            modifiedAt: "2022-12-26T08:50:00Z",
            scheduledAt: "2022-12-27T09:50:00Z",
            senderNumber: "senderNumber",
            stats: { delivered: 3, notSent: 4, read: 2, sent: 3, unsubscribe: 0 },
            template: {
                body_variables: [{ datatype: "text", default: "INVALID_HEADER", name: "FIRSTNAME" }],
                button_type: "CALL_TO_ACTION",
                category: "MARKETING",
                components: [
                    { text: "making it look like readable English.", type: "BODY" },
                    { text: "Life is a long lesson in humility", type: "BUTTONS" },
                ],
                contains_button: true,
                display_header: false,
                header_type: "text",
                header_variables: [{ datatype: "text", default: "INVALID HEADER", name: "FIRSTNAME" }],
                hide_footer: true,
                language: "en",
                name: "official_campaign8",
            },
        };
        server
            .mockEndpoint()
            .get("/whatsappCampaigns/1000000")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.whatsAppCampaigns.getWhatsAppCampaign({
            campaignId: 1000000,
        });
        expect(response).toEqual({
            campaignName: "Test WhatsApp Campaign",
            campaignStatus: "sent",
            createdAt: "2022-12-26T06:50:00Z",
            id: 1672035851100690,
            modifiedAt: "2022-12-26T08:50:00Z",
            scheduledAt: "2022-12-27T09:50:00Z",
            senderNumber: "senderNumber",
            stats: {
                delivered: 3,
                notSent: 4,
                read: 2,
                sent: 3,
                unsubscribe: 0,
            },
            template: {
                body_variables: [
                    {
                        datatype: "text",
                        default: "INVALID_HEADER",
                        name: "FIRSTNAME",
                    },
                ],
                button_type: "CALL_TO_ACTION",
                category: "MARKETING",
                components: [
                    {
                        text: "making it look like readable English.",
                        type: "BODY",
                    },
                    {
                        text: "Life is a long lesson in humility",
                        type: "BUTTONS",
                    },
                ],
                contains_button: true,
                display_header: false,
                header_type: "text",
                header_variables: [
                    {
                        datatype: "text",
                        default: "INVALID HEADER",
                        name: "FIRSTNAME",
                    },
                ],
                hide_footer: true,
                language: "en",
                name: "official_campaign8",
            },
        });
    });

    test("getWhatsAppCampaign (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/whatsappCampaigns/1000000")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.getWhatsAppCampaign({
                campaignId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getWhatsAppCampaign (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/whatsappCampaigns/1000000")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.getWhatsAppCampaign({
                campaignId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("updateWhatsAppCampaign (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server
            .mockEndpoint()
            .put("/whatsappCampaigns/1000000")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.whatsAppCampaigns.updateWhatsAppCampaign({
            campaignId: 1000000,
        });
        expect(response).toEqual(undefined);
    });

    test("updateWhatsAppCampaign (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/whatsappCampaigns/1000000")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.updateWhatsAppCampaign({
                campaignId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteWhatsAppCampaign (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/whatsappCampaigns/1000000").respondWith().statusCode(200).build();

        const response = await client.whatsAppCampaigns.deleteWhatsAppCampaign({
            campaignId: 1000000,
        });
        expect(response).toEqual(undefined);
    });

    test("deleteWhatsAppCampaign (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/whatsappCampaigns/1000000")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.deleteWhatsAppCampaign({
                campaignId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteWhatsAppCampaign (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/whatsappCampaigns/1000000")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.whatsAppCampaigns.deleteWhatsAppCampaign({
                campaignId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });
});
