// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("CompaniesClient", () => {
    test("getAllCompanies (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            items: [
                {
                    attributes: {
                        created_at: "2022-01-13T19:04:24.376+05:30",
                        domain: "xyz",
                        last_updated_at: "2022-04-01T18:47:48.283+05:30",
                        name: "text",
                        number_of_contacts: 0,
                        owner: "62260474111b1101704a9d85",
                        owner_assign_date: "2022-04-01T18:21:13.379+05:30",
                        phone_number: 8171844192,
                        revenue: 10,
                    },
                    id: "629475917295261d9b1f4403",
                    linkedContactsIds: [1, 2, 3],
                    linkedDealsIds: [
                        "61a5ce58c5d4795761045990",
                        "61a5ce58c5d4795761045991",
                        "61a5ce58c5d4795761045992",
                    ],
                },
            ],
        };
        server.mockEndpoint().get("/companies").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.companies.getAllCompanies();
        expect(response).toEqual({
            items: [
                {
                    attributes: {
                        created_at: "2022-01-13T19:04:24.376+05:30",
                        domain: "xyz",
                        last_updated_at: "2022-04-01T18:47:48.283+05:30",
                        name: "text",
                        number_of_contacts: 0,
                        owner: "62260474111b1101704a9d85",
                        owner_assign_date: "2022-04-01T18:21:13.379+05:30",
                        phone_number: 8171844192,
                        revenue: 10,
                    },
                    id: "629475917295261d9b1f4403",
                    linkedContactsIds: [1, 2, 3],
                    linkedDealsIds: [
                        "61a5ce58c5d4795761045990",
                        "61a5ce58c5d4795761045991",
                        "61a5ce58c5d4795761045992",
                    ],
                },
            ],
        });
    });

    test("getAllCompanies (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/companies").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.companies.getAllCompanies();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("createACompany (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "company" };
        const rawResponseBody = { id: "61a5cd07ca1347c82306ad06" };
        server
            .mockEndpoint()
            .post("/companies")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.companies.createACompany({
            name: "company",
        });
        expect(response).toEqual({
            id: "61a5cd07ca1347c82306ad06",
        });
    });

    test("createACompany (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "name" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/companies")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.companies.createACompany({
                name: "name",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("linkAndUnlinkCompanyWithContactAndDeal (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server
            .mockEndpoint()
            .patch("/companies/link-unlink/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.companies.linkAndUnlinkCompanyWithContactAndDeal({
            id: "id",
        });
        expect(response).toEqual(undefined);
    });

    test("linkAndUnlinkCompanyWithContactAndDeal (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .patch("/companies/link-unlink/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.companies.linkAndUnlinkCompanyWithContactAndDeal({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getACompany (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            attributes: {
                created_at: "2022-01-13T19:04:24.376+05:30",
                domain: "xyz",
                last_updated_at: "2022-04-01T18:47:48.283+05:30",
                name: "text",
                number_of_contacts: 0,
                owner: "62260474111b1101704a9d85",
                owner_assign_date: "2022-04-01T18:21:13.379+05:30",
                phone_number: 8171844192,
                revenue: 10,
            },
            id: "629475917295261d9b1f4403",
            linkedContactsIds: [1, 2, 3],
            linkedDealsIds: ["61a5ce58c5d4795761045990", "61a5ce58c5d4795761045991", "61a5ce58c5d4795761045992"],
        };
        server.mockEndpoint().get("/companies/id").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.companies.getACompany({
            id: "id",
        });
        expect(response).toEqual({
            attributes: {
                created_at: "2022-01-13T19:04:24.376+05:30",
                domain: "xyz",
                last_updated_at: "2022-04-01T18:47:48.283+05:30",
                name: "text",
                number_of_contacts: 0,
                owner: "62260474111b1101704a9d85",
                owner_assign_date: "2022-04-01T18:21:13.379+05:30",
                phone_number: 8171844192,
                revenue: 10,
            },
            id: "629475917295261d9b1f4403",
            linkedContactsIds: [1, 2, 3],
            linkedDealsIds: ["61a5ce58c5d4795761045990", "61a5ce58c5d4795761045991", "61a5ce58c5d4795761045992"],
        });
    });

    test("getACompany (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/companies/id").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.companies.getACompany({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getACompany (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/companies/id").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.companies.getACompany({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("deleteACompany (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/companies/id").respondWith().statusCode(200).build();

        const response = await client.companies.deleteACompany({
            id: "id",
        });
        expect(response).toEqual(undefined);
    });

    test("deleteACompany (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().delete("/companies/id").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.companies.deleteACompany({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteACompany (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().delete("/companies/id").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.companies.deleteACompany({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("updateACompany (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = {
            attributes: {
                created_at: "2022-01-13T19:04:24.376+05:30",
                domain: "xyz",
                last_updated_at: "2022-04-01T18:47:48.283+05:30",
                name: "text",
                number_of_contacts: 0,
                owner: "62260474111b1101704a9d85",
                owner_assign_date: "2022-04-01T18:21:13.379+05:30",
                phone_number: 8171844192,
                revenue: 10,
            },
            id: "629475917295261d9b1f4403",
            linkedContactsIds: [1, 2, 3],
            linkedDealsIds: ["61a5ce58c5d4795761045990", "61a5ce58c5d4795761045991", "61a5ce58c5d4795761045992"],
        };
        server
            .mockEndpoint()
            .patch("/companies/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.companies.updateACompany({
            id: "id",
        });
        expect(response).toEqual({
            attributes: {
                created_at: "2022-01-13T19:04:24.376+05:30",
                domain: "xyz",
                last_updated_at: "2022-04-01T18:47:48.283+05:30",
                name: "text",
                number_of_contacts: 0,
                owner: "62260474111b1101704a9d85",
                owner_assign_date: "2022-04-01T18:21:13.379+05:30",
                phone_number: 8171844192,
                revenue: 10,
            },
            id: "629475917295261d9b1f4403",
            linkedContactsIds: [1, 2, 3],
            linkedDealsIds: ["61a5ce58c5d4795761045990", "61a5ce58c5d4795761045991", "61a5ce58c5d4795761045992"],
        });
    });

    test("updateACompany (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .patch("/companies/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.companies.updateACompany({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("updateACompany (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .patch("/companies/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.companies.updateACompany({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("createACompanyDealAttribute (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { attributeType: "text", label: "Attribute Label", objectType: "companies" };
        const rawResponseBody = { id: "61a5cd07ca1347c82306ad07" };
        server
            .mockEndpoint()
            .post("/crm/attributes")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.companies.createACompanyDealAttribute({
            attributeType: "text",
            label: "Attribute Label",
            objectType: "companies",
        });
        expect(response).toEqual({
            id: "61a5cd07ca1347c82306ad07",
        });
    });

    test("createACompanyDealAttribute (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { attributeType: "text", label: "label", objectType: "companies" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/crm/attributes")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.companies.createACompanyDealAttribute({
                attributeType: "text",
                label: "label",
                objectType: "companies",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getCompanyAttributes", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                attributeOptions: [{ key: "custom key", value: "custom label" }],
                attributeTypeName: "text",
                internalName: "name",
                isRequired: true,
                label: "Company Name",
            },
        ];
        server
            .mockEndpoint()
            .get("/crm/attributes/companies")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.companies.getCompanyAttributes();
        expect(response).toEqual([
            {
                attributeOptions: [
                    {
                        key: "custom key",
                        value: "custom label",
                    },
                ],
                attributeTypeName: "text",
                internalName: "name",
                isRequired: true,
                label: "Company Name",
            },
        ]);
    });
});
