// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("DealsClient", () => {
    test("getDealAttributes", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                attributeOptions: [{ key: "custom key", value: "custom label" }],
                attributeTypeName: "text",
                internalName: "deal_name",
                isRequired: true,
                label: "Deal Name",
            },
        ];
        server
            .mockEndpoint()
            .get("/crm/attributes/deals")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.deals.getDealAttributes();
        expect(response).toEqual([
            {
                attributeOptions: [
                    {
                        key: "custom key",
                        value: "custom label",
                    },
                ],
                attributeTypeName: "text",
                internalName: "deal_name",
                isRequired: true,
                label: "Deal Name",
            },
        ]);
    });

    test("getAllDeals (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            items: [
                {
                    attributes: {
                        amount: 12,
                        created_at: "2022-05-30T07:42:05.671Z",
                        deal_name: "testname",
                        deal_owner: "6093d2425a9b436e9519d034",
                        deal_stage: "9e577ff7-8e42-4ab3-be26-2b5e01b42518",
                        last_activity_date: "2022-06-06T08:38:36.000Z",
                        last_updated_date: "2022-06-06T08:38:36.761Z",
                        number_of_activities: 0,
                        number_of_contacts: 1,
                        pipeline: "6093d296ad1e9c5cf2140a58",
                        stage_updated_at: "2022-05-30T07:42:05.671Z",
                    },
                    id: "629475917295261d9b1f4403",
                    linkedCompaniesIds: [
                        "61a5ce58c5d4795761045990",
                        "61a5ce58c5d4795761045991",
                        "61a5ce58c5d4795761045992",
                    ],
                    linkedContactsIds: [1, 2, 3],
                },
            ],
        };
        server.mockEndpoint().get("/crm/deals").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.deals.getAllDeals();
        expect(response).toEqual({
            items: [
                {
                    attributes: {
                        amount: 12,
                        created_at: "2022-05-30T07:42:05.671Z",
                        deal_name: "testname",
                        deal_owner: "6093d2425a9b436e9519d034",
                        deal_stage: "9e577ff7-8e42-4ab3-be26-2b5e01b42518",
                        last_activity_date: "2022-06-06T08:38:36.000Z",
                        last_updated_date: "2022-06-06T08:38:36.761Z",
                        number_of_activities: 0,
                        number_of_contacts: 1,
                        pipeline: "6093d296ad1e9c5cf2140a58",
                        stage_updated_at: "2022-05-30T07:42:05.671Z",
                    },
                    id: "629475917295261d9b1f4403",
                    linkedCompaniesIds: [
                        "61a5ce58c5d4795761045990",
                        "61a5ce58c5d4795761045991",
                        "61a5ce58c5d4795761045992",
                    ],
                    linkedContactsIds: [1, 2, 3],
                },
            ],
        });
    });

    test("getAllDeals (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/crm/deals").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.deals.getAllDeals();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("createADeal (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "Deal: Connect with company" };
        const rawResponseBody = { id: "61a5cd07ca1347c82306ad06" };
        server
            .mockEndpoint()
            .post("/crm/deals")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.deals.createADeal({
            name: "Deal: Connect with company",
        });
        expect(response).toEqual({
            id: "61a5cd07ca1347c82306ad06",
        });
    });

    test("createADeal (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "name" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/crm/deals")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.deals.createADeal({
                name: "name",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("linkAndUnlinkADealWithContactsAndCompanies (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server
            .mockEndpoint()
            .patch("/crm/deals/link-unlink/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.deals.linkAndUnlinkADealWithContactsAndCompanies({
            id: "id",
        });
        expect(response).toEqual(undefined);
    });

    test("linkAndUnlinkADealWithContactsAndCompanies (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .patch("/crm/deals/link-unlink/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.deals.linkAndUnlinkADealWithContactsAndCompanies({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getADeal (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            attributes: {
                amount: 12,
                created_at: "2022-05-30T07:42:05.671Z",
                deal_name: "testname",
                deal_owner: "6093d2425a9b436e9519d034",
                deal_stage: "9e577ff7-8e42-4ab3-be26-2b5e01b42518",
                last_activity_date: "2022-06-06T08:38:36.000Z",
                last_updated_date: "2022-06-06T08:38:36.761Z",
                next_activity_date: { key: "value" },
                number_of_activities: 0,
                number_of_contacts: 1,
                pipeline: "6093d296ad1e9c5cf2140a58",
                stage_updated_at: "2022-05-30T07:42:05.671Z",
            },
            id: "629475917295261d9b1f4403",
            linkedCompaniesIds: ["61a5ce58c5d4795761045990", "61a5ce58c5d4795761045991", "61a5ce58c5d4795761045992"],
            linkedContactsIds: [1, 2, 3],
        };
        server.mockEndpoint().get("/crm/deals/id").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.deals.getADeal({
            id: "id",
        });
        expect(response).toEqual({
            attributes: {
                amount: 12,
                created_at: "2022-05-30T07:42:05.671Z",
                deal_name: "testname",
                deal_owner: "6093d2425a9b436e9519d034",
                deal_stage: "9e577ff7-8e42-4ab3-be26-2b5e01b42518",
                last_activity_date: "2022-06-06T08:38:36.000Z",
                last_updated_date: "2022-06-06T08:38:36.761Z",
                next_activity_date: {
                    key: "value",
                },
                number_of_activities: 0,
                number_of_contacts: 1,
                pipeline: "6093d296ad1e9c5cf2140a58",
                stage_updated_at: "2022-05-30T07:42:05.671Z",
            },
            id: "629475917295261d9b1f4403",
            linkedCompaniesIds: ["61a5ce58c5d4795761045990", "61a5ce58c5d4795761045991", "61a5ce58c5d4795761045992"],
            linkedContactsIds: [1, 2, 3],
        });
    });

    test("getADeal (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/crm/deals/id").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.deals.getADeal({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getADeal (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/crm/deals/id").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.deals.getADeal({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("deleteADeal (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/crm/deals/id").respondWith().statusCode(200).build();

        const response = await client.deals.deleteADeal({
            id: "id",
        });
        expect(response).toEqual(undefined);
    });

    test("deleteADeal (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().delete("/crm/deals/id").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.deals.deleteADeal({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteADeal (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().delete("/crm/deals/id").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.deals.deleteADeal({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("updateADeal (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server.mockEndpoint().patch("/crm/deals/id").jsonBody(rawRequestBody).respondWith().statusCode(200).build();

        const response = await client.deals.updateADeal({
            id: "id",
        });
        expect(response).toEqual(undefined);
    });

    test("updateADeal (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .patch("/crm/deals/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.deals.updateADeal({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("updateADeal (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .patch("/crm/deals/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.deals.updateADeal({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("getPipelineStages", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            pipeline: "5ea675e3da0dd085acaea610",
            pipeline_name: "Sales Pipeline",
            stages: [{ id: "9e577ff7-8e42-4ab3-be26-2b5e01b42518", name: "New" }],
        };
        server
            .mockEndpoint()
            .get("/crm/pipeline/details")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.deals.getPipelineStages();
        expect(response).toEqual({
            pipeline: "5ea675e3da0dd085acaea610",
            pipeline_name: "Sales Pipeline",
            stages: [
                {
                    id: "9e577ff7-8e42-4ab3-be26-2b5e01b42518",
                    name: "New",
                },
            ],
        });
    });

    test("getAllPipelines (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                pipeline: "5ea675e3da0dd085acaea610",
                pipeline_name: "Sales Pipeline",
                stages: [{ id: "9e577ff7-8e42-4ab3-be26-2b5e01b42518", name: "New" }],
            },
        ];
        server
            .mockEndpoint()
            .get("/crm/pipeline/details/all")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.deals.getAllPipelines();
        expect(response).toEqual([
            {
                pipeline: "5ea675e3da0dd085acaea610",
                pipeline_name: "Sales Pipeline",
                stages: [
                    {
                        id: "9e577ff7-8e42-4ab3-be26-2b5e01b42518",
                        name: "New",
                    },
                ],
            },
        ]);
    });

    test("getAllPipelines (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/crm/pipeline/details/all")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.deals.getAllPipelines();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getAPipeline (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = [
            {
                pipeline: "5ea675e3da0dd085acaea610",
                pipeline_name: "Sales Pipeline",
                stages: [{ id: "9e577ff7-8e42-4ab3-be26-2b5e01b42518", name: "New" }],
            },
        ];
        server
            .mockEndpoint()
            .get("/crm/pipeline/details/pipelineID")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.deals.getAPipeline({
            pipelineID: "pipelineID",
        });
        expect(response).toEqual([
            {
                pipeline: "5ea675e3da0dd085acaea610",
                pipeline_name: "Sales Pipeline",
                stages: [
                    {
                        id: "9e577ff7-8e42-4ab3-be26-2b5e01b42518",
                        name: "New",
                    },
                ],
            },
        ]);
    });

    test("getAPipeline (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/crm/pipeline/details/pipelineID")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.deals.getAPipeline({
                pipelineID: "pipelineID",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });
});
