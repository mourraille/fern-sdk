// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("ProcessClient", () => {
    test("getProcesses (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            count: 198,
            processes: [
                {
                    id: 217,
                    name: "IMPORTUSER",
                    status: "completed",
                    export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
                    error: "Processing timeout exceeded",
                    created_at: "2024-01-15T10:30:00Z",
                    completed_at: "2024-01-15T10:35:00Z",
                },
                {
                    id: 213,
                    name: "SEARCH_EXPORT_USERS",
                    status: "completed",
                    export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
                    error: "Processing timeout exceeded",
                    created_at: "2024-01-15T10:30:00Z",
                    completed_at: "2024-01-15T10:35:00Z",
                },
                {
                    id: 212,
                    name: "IMPORTUSER",
                    status: "queued",
                    export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
                    error: "Processing timeout exceeded",
                    created_at: "2024-01-15T10:30:00Z",
                    completed_at: "2024-01-15T10:35:00Z",
                },
            ],
        };
        server.mockEndpoint().get("/processes").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.process.getProcesses();
        expect(response).toEqual({
            count: 198,
            processes: [
                {
                    id: 217,
                    name: "IMPORTUSER",
                    status: "completed",
                    export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
                    error: "Processing timeout exceeded",
                    created_at: "2024-01-15T10:30:00Z",
                    completed_at: "2024-01-15T10:35:00Z",
                },
                {
                    id: 213,
                    name: "SEARCH_EXPORT_USERS",
                    status: "completed",
                    export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
                    error: "Processing timeout exceeded",
                    created_at: "2024-01-15T10:30:00Z",
                    completed_at: "2024-01-15T10:35:00Z",
                },
                {
                    id: 212,
                    name: "IMPORTUSER",
                    status: "queued",
                    export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
                    error: "Processing timeout exceeded",
                    created_at: "2024-01-15T10:30:00Z",
                    completed_at: "2024-01-15T10:35:00Z",
                },
            ],
        });
    });

    test("getProcesses (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/processes").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.process.getProcesses();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getProcess (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: 217,
            name: "IMPORTUSER",
            status: "queued",
            info: {
                import: {
                    invalid_emails: 2,
                    duplicate_contact_id: 0,
                    duplicate_ext_id: 1,
                    duplicate_email_id: 5,
                    duplicate_phone_id: 1,
                    duplicate_whatsapp_id: 1,
                    duplicate_landline_number_id: 1,
                },
                export: { total_records: 1250, file_size: 102400 },
            },
            export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
            error: "Processing timeout exceeded after 30 minutes",
            created_at: "2024-01-15T10:30:00Z",
            completed_at: "2024-01-15T10:32:15Z",
        };
        server.mockEndpoint().get("/processes/1000000").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.process.getProcess({
            processId: 1000000,
        });
        expect(response).toEqual({
            id: 217,
            name: "IMPORTUSER",
            status: "queued",
            info: {
                import: {
                    invalid_emails: 2,
                    duplicate_contact_id: 0,
                    duplicate_ext_id: 1,
                    duplicate_email_id: 5,
                    duplicate_phone_id: 1,
                    duplicate_whatsapp_id: 1,
                    duplicate_landline_number_id: 1,
                },
                export: {
                    total_records: 1250,
                    file_size: 102400,
                },
            },
            export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
            error: "Processing timeout exceeded after 30 minutes",
            created_at: "2024-01-15T10:30:00Z",
            completed_at: "2024-01-15T10:32:15Z",
        });
    });

    test("getProcess (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: 217,
            name: "IMPORTUSER",
            status: "completed",
            info: { export: { total_records: 1250, file_size: 102400 } },
            export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
            error: "Processing timeout exceeded after 30 minutes",
            created_at: "2024-01-15T10:30:00Z",
            completed_at: "2024-01-15T10:32:15Z",
        };
        server.mockEndpoint().get("/processes/1000000").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.process.getProcess({
            processId: 1000000,
        });
        expect(response).toEqual({
            id: 217,
            name: "IMPORTUSER",
            status: "completed",
            info: {
                export: {
                    total_records: 1250,
                    file_size: 102400,
                },
            },
            export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
            error: "Processing timeout exceeded after 30 minutes",
            created_at: "2024-01-15T10:30:00Z",
            completed_at: "2024-01-15T10:32:15Z",
        });
    });

    test("getProcess (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: 213,
            name: "SEARCH_EXPORT_USERS",
            status: "completed",
            info: {
                import: {
                    invalid_emails: 2,
                    duplicate_contact_id: 0,
                    duplicate_ext_id: 1,
                    duplicate_email_id: 5,
                    duplicate_phone_id: 1,
                    duplicate_whatsapp_id: 1,
                    duplicate_landline_number_id: 1,
                },
                export: { total_records: 1250, file_size: 102400 },
            },
            export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
            error: "Processing timeout exceeded after 30 minutes",
            created_at: "2024-01-15T10:30:00Z",
            completed_at: "2024-01-15T10:32:15Z",
        };
        server.mockEndpoint().get("/processes/1000000").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.process.getProcess({
            processId: 1000000,
        });
        expect(response).toEqual({
            id: 213,
            name: "SEARCH_EXPORT_USERS",
            status: "completed",
            info: {
                import: {
                    invalid_emails: 2,
                    duplicate_contact_id: 0,
                    duplicate_ext_id: 1,
                    duplicate_email_id: 5,
                    duplicate_phone_id: 1,
                    duplicate_whatsapp_id: 1,
                    duplicate_landline_number_id: 1,
                },
                export: {
                    total_records: 1250,
                    file_size: 102400,
                },
            },
            export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
            error: "Processing timeout exceeded after 30 minutes",
            created_at: "2024-01-15T10:30:00Z",
            completed_at: "2024-01-15T10:32:15Z",
        });
    });

    test("getProcess (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: 189,
            name: "TRANS-GLOBAL-CALC",
            status: "failed",
            info: {
                import: {
                    invalid_emails: 2,
                    duplicate_contact_id: 0,
                    duplicate_ext_id: 1,
                    duplicate_email_id: 5,
                    duplicate_phone_id: 1,
                    duplicate_whatsapp_id: 1,
                    duplicate_landline_number_id: 1,
                },
                export: { total_records: 1250, file_size: 102400 },
            },
            export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
            error: "Processing timeout exceeded after 30 minutes",
            created_at: "2024-01-15T10:30:00Z",
            completed_at: "2024-01-15T10:32:15Z",
        };
        server.mockEndpoint().get("/processes/1000000").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.process.getProcess({
            processId: 1000000,
        });
        expect(response).toEqual({
            id: 189,
            name: "TRANS-GLOBAL-CALC",
            status: "failed",
            info: {
                import: {
                    invalid_emails: 2,
                    duplicate_contact_id: 0,
                    duplicate_ext_id: 1,
                    duplicate_email_id: 5,
                    duplicate_phone_id: 1,
                    duplicate_whatsapp_id: 1,
                    duplicate_landline_number_id: 1,
                },
                export: {
                    total_records: 1250,
                    file_size: 102400,
                },
            },
            export_url: "https://s3.eu-west-1.amazonaws.com/api-export.example.com/upload/contacts_export.csv",
            error: "Processing timeout exceeded after 30 minutes",
            created_at: "2024-01-15T10:30:00Z",
            completed_at: "2024-01-15T10:32:15Z",
        });
    });

    test("getProcess (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/processes/1000000").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.process.getProcess({
                processId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getProcess (6)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/processes/1000000").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.process.getProcess({
                processId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });
});
