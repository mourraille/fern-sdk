// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("WebhooksClient", () => {
    test("getWebhooks (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            webhooks: [
                {
                    auth: { token: "test-auth-token1234", type: "bearer" },
                    batched: true,
                    channel: "email",
                    createdAt: "2016-07-18T12:30:09Z",
                    description: "Webhook triggered on campaign openings",
                    events: ["opened"],
                    headers: [{ key: "cf-secret", value: "test-header-value" }],
                    id: 9864,
                    modifiedAt: "2016-07-18T16:00:50Z",
                    type: "transactional",
                    url: "https://example.domain.com/webhook/events/kzfxxxxxxxx0uyo1",
                },
                {
                    auth: { token: "test-auth-token1234", type: "bearer" },
                    batched: true,
                    channel: "sms",
                    createdAt: "2017-02-20T14:30:00Z",
                    description: "Webhook triggered on campaign hard bounces",
                    events: ["hardBounces"],
                    headers: [{ key: "cf-secret", value: "test-header-value" }],
                    id: 22770,
                    modifiedAt: "2017-02-20T19:00:00Z",
                    type: "marketing",
                    url: "http://exmaple.domain.com/15kxxxxxn1",
                },
            ],
        };
        server.mockEndpoint().get("/webhooks").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.webhooks.getWebhooks();
        expect(response).toEqual({
            webhooks: [
                {
                    auth: {
                        token: "test-auth-token1234",
                        type: "bearer",
                    },
                    batched: true,
                    channel: "email",
                    createdAt: "2016-07-18T12:30:09Z",
                    description: "Webhook triggered on campaign openings",
                    events: ["opened"],
                    headers: [
                        {
                            key: "cf-secret",
                            value: "test-header-value",
                        },
                    ],
                    id: 9864,
                    modifiedAt: "2016-07-18T16:00:50Z",
                    type: "transactional",
                    url: "https://example.domain.com/webhook/events/kzfxxxxxxxx0uyo1",
                },
                {
                    auth: {
                        token: "test-auth-token1234",
                        type: "bearer",
                    },
                    batched: true,
                    channel: "sms",
                    createdAt: "2017-02-20T14:30:00Z",
                    description: "Webhook triggered on campaign hard bounces",
                    events: ["hardBounces"],
                    headers: [
                        {
                            key: "cf-secret",
                            value: "test-header-value",
                        },
                    ],
                    id: 22770,
                    modifiedAt: "2017-02-20T19:00:00Z",
                    type: "marketing",
                    url: "http://exmaple.domain.com/15kxxxxxn1",
                },
            ],
        });
    });

    test("getWebhooks (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/webhooks").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.webhooks.getWebhooks();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("createWebhook (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { events: ["sent"], url: "http://requestb.in/173lyyx1" };
        const rawResponseBody = { id: 5 };
        server
            .mockEndpoint()
            .post("/webhooks")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.webhooks.createWebhook({
            events: ["sent"],
            url: "http://requestb.in/173lyyx1",
        });
        expect(response).toEqual({
            id: 5,
        });
    });

    test("createWebhook (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { events: ["sent", "sent"], url: "url" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/webhooks")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.webhooks.createWebhook({
                events: ["sent", "sent"],
                url: "url",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("exportWebhooksHistory (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { event: "invalid_parameter", notifyURL: "https://brevo.com", type: "transactional" };
        const rawResponseBody = { processId: 78 };
        server
            .mockEndpoint()
            .post("/webhooks/export")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.webhooks.exportWebhooksHistory({
            event: "invalid_parameter",
            notifyURL: "https://brevo.com",
            type: "transactional",
        });
        expect(response).toEqual({
            processId: 78,
        });
    });

    test("exportWebhooksHistory (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { event: "invalid_parameter", notifyURL: "notifyURL", type: "transactional" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/webhooks/export")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.webhooks.exportWebhooksHistory({
                event: "invalid_parameter",
                notifyURL: "notifyURL",
                type: "transactional",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getWebhook (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            auth: { token: "test-auth-token1234", type: "bearer" },
            batched: true,
            channel: "sms",
            createdAt: "2016-06-07T09:10:10Z",
            description: "Webhook triggered on campaign openings and addition of lists",
            events: ["listAdditions", "opened"],
            headers: [{ key: "cf-secret", value: "test-header-value" }],
            id: 7287,
            modifiedAt: "2016-06-08T11:30:00Z",
            type: "marketing",
            url: "http://example.domain.com/1brxxxxxx5p1",
        };
        server.mockEndpoint().get("/webhooks/1000000").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.webhooks.getWebhook({
            webhookId: 1000000,
        });
        expect(response).toEqual({
            auth: {
                token: "test-auth-token1234",
                type: "bearer",
            },
            batched: true,
            channel: "sms",
            createdAt: "2016-06-07T09:10:10Z",
            description: "Webhook triggered on campaign openings and addition of lists",
            events: ["listAdditions", "opened"],
            headers: [
                {
                    key: "cf-secret",
                    value: "test-header-value",
                },
            ],
            id: 7287,
            modifiedAt: "2016-06-08T11:30:00Z",
            type: "marketing",
            url: "http://example.domain.com/1brxxxxxx5p1",
        });
    });

    test("getWebhook (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/webhooks/1000000").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.webhooks.getWebhook({
                webhookId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getWebhook (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/webhooks/1000000").respondWith().statusCode(404).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.webhooks.getWebhook({
                webhookId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("updateWebhook (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server.mockEndpoint().put("/webhooks/1000000").jsonBody(rawRequestBody).respondWith().statusCode(200).build();

        const response = await client.webhooks.updateWebhook({
            webhookId: 1000000,
        });
        expect(response).toEqual(undefined);
    });

    test("updateWebhook (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/webhooks/1000000")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.webhooks.updateWebhook({
                webhookId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("updateWebhook (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/webhooks/1000000")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.webhooks.updateWebhook({
                webhookId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("deleteWebhook (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/webhooks/1000000").respondWith().statusCode(200).build();

        const response = await client.webhooks.deleteWebhook({
            webhookId: 1000000,
        });
        expect(response).toEqual(undefined);
    });

    test("deleteWebhook (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/webhooks/1000000")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.webhooks.deleteWebhook({
                webhookId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteWebhook (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/webhooks/1000000")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.webhooks.deleteWebhook({
                webhookId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });
});
