// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("PaymentsClient", () => {
    test("createPaymentRequest (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            cart: { currency: "EUR", specificAmount: 1200 },
            contactId: 43,
            reference: "Invoice #INV0001",
        };
        const rawResponseBody = { id: 122, url: "https://pay.brevo.com/payment/6d4ec0b2b48ef803df4103ve" };
        server
            .mockEndpoint()
            .post("/payments/requests")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payments.createPaymentRequest({
            cart: {
                currency: "EUR",
                specificAmount: 1200,
            },
            contactId: 43,
            reference: "Invoice #INV0001",
        });
        expect(response).toEqual({
            id: 122,
            url: "https://pay.brevo.com/payment/6d4ec0b2b48ef803df4103ve",
        });
    });

    test("createPaymentRequest (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            cart: { currency: "EUR", specificAmount: 1000000 },
            contactId: 1000000,
            reference: "reference",
        };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/payments/requests")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.createPaymentRequest({
                cart: {
                    currency: "EUR",
                    specificAmount: 1000000,
                },
                contactId: 1000000,
                reference: "reference",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("createPaymentRequest (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            cart: { currency: "EUR", specificAmount: 1000000 },
            contactId: 1000000,
            reference: "reference",
        };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/payments/requests")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.createPaymentRequest({
                cart: {
                    currency: "EUR",
                    specificAmount: 1000000,
                },
                contactId: 1000000,
                reference: "reference",
            });
        }).rejects.toThrow(BrevoApi.UnauthorizedError);
    });

    test("createPaymentRequest (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            cart: { currency: "EUR", specificAmount: 1000000 },
            contactId: 1000000,
            reference: "reference",
        };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/payments/requests")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.createPaymentRequest({
                cart: {
                    currency: "EUR",
                    specificAmount: 1000000,
                },
                contactId: 1000000,
                reference: "reference",
            });
        }).rejects.toThrow(BrevoApi.ForbiddenError);
    });

    test("getPaymentRequest (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            cart: { currency: "EUR", specificAmount: 1200 },
            configuration: { customSuccessUrl: "https://my-company.com/payment-success" },
            contactId: 43,
            notification: { channel: "email", text: "Please pay for your yoga class." },
            numberOfRemindersSent: 5,
            reference: "Invoice #INV0001\n",
            status: "paid",
        };
        server
            .mockEndpoint()
            .get("/payments/requests/050db7b0-9bb7-4c1e-9c68-5a8dace8c1dc")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.payments.getPaymentRequest({
            id: "050db7b0-9bb7-4c1e-9c68-5a8dace8c1dc",
        });
        expect(response).toEqual({
            cart: {
                currency: "EUR",
                specificAmount: 1200,
            },
            configuration: {
                customSuccessUrl: "https://my-company.com/payment-success",
            },
            contactId: 43,
            notification: {
                channel: "email",
                text: "Please pay for your yoga class.",
            },
            numberOfRemindersSent: 5,
            reference: "Invoice #INV0001\n",
            status: "paid",
        });
    });

    test("getPaymentRequest (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/payments/requests/id")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.getPaymentRequest({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getPaymentRequest (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/payments/requests/id")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.getPaymentRequest({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.UnauthorizedError);
    });

    test("getPaymentRequest (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/payments/requests/id")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.getPaymentRequest({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.ForbiddenError);
    });

    test("getPaymentRequest (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/payments/requests/id")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.getPaymentRequest({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("deletePaymentRequest (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server
            .mockEndpoint()
            .delete("/payments/requests/9ae7d68a-565c-4695-9381-d8fb3e3a14cc")
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.payments.deletePaymentRequest({
            id: "9ae7d68a-565c-4695-9381-d8fb3e3a14cc",
        });
        expect(response).toEqual(undefined);
    });

    test("deletePaymentRequest (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/payments/requests/id")
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.deletePaymentRequest({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.UnauthorizedError);
    });

    test("deletePaymentRequest (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/payments/requests/id")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.deletePaymentRequest({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.ForbiddenError);
    });

    test("deletePaymentRequest (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/payments/requests/id")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.payments.deletePaymentRequest({
                id: "id",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });
});
