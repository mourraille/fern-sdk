// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("UserClient", () => {
    test("getInvitedUsersList (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            users: [
                {
                    email: "owner@company.com",
                    feature_access: { conversations: "owner", crm: "owner", marketing: "owner" },
                    is_owner: "is_owner",
                    status: "active",
                },
                {
                    email: "pendingInvitedUser@company.com",
                    feature_access: { conversations: "none", crm: "full", marketing: "custom" },
                    is_owner: "is_owner",
                    status: "pending",
                },
                {
                    email: "connectedInvitedUser@company.com",
                    feature_access: { conversations: "full", crm: "none", marketing: "none" },
                    is_owner: "is_owner",
                    status: "active",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/organization/invited/users")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.user.getInvitedUsersList();
        expect(response).toEqual({
            users: [
                {
                    email: "owner@company.com",
                    feature_access: {
                        conversations: "owner",
                        crm: "owner",
                        marketing: "owner",
                    },
                    is_owner: "is_owner",
                    status: "active",
                },
                {
                    email: "pendingInvitedUser@company.com",
                    feature_access: {
                        conversations: "none",
                        crm: "full",
                        marketing: "custom",
                    },
                    is_owner: "is_owner",
                    status: "pending",
                },
                {
                    email: "connectedInvitedUser@company.com",
                    feature_access: {
                        conversations: "full",
                        crm: "none",
                        marketing: "none",
                    },
                    is_owner: "is_owner",
                    status: "active",
                },
            ],
        });
    });

    test("getInvitedUsersList (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/organization/invited/users")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.user.getInvitedUsersList();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("putRevokeUserPermission (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { credit_notes: ["TEST-123"], status: "OK" };
        server
            .mockEndpoint()
            .put("/organization/user/invitation/revoke/email")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.user.putRevokeUserPermission({
            email: "email",
        });
        expect(response).toEqual({
            credit_notes: ["TEST-123"],
            status: "OK",
        });
    });

    test("putRevokeUserPermission (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/organization/user/invitation/revoke/email")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.user.putRevokeUserPermission({
                email: "email",
            });
        }).rejects.toThrow(BrevoApi.ForbiddenError);
    });

    test("inviteuser (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { all_features_access: true, email: "inviteuser@example.com", privileges: [{}] };
        const rawResponseBody = { invoice_id: "invoice_id", status: "OK" };
        server
            .mockEndpoint()
            .post("/organization/user/invitation/send")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.user.inviteuser({
            all_features_access: true,
            email: "inviteuser@example.com",
            privileges: [{}],
        });
        expect(response).toEqual({
            invoice_id: "invoice_id",
            status: "OK",
        });
    });

    test("inviteuser (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { all_features_access: true, email: "email", privileges: [{}, {}] };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/organization/user/invitation/send")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.user.inviteuser({
                all_features_access: true,
                email: "email",
                privileges: [{}, {}],
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("putresendcancelinvitation (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { credit_notes: ["TEST-123"], status: "OK" };
        server
            .mockEndpoint()
            .put("/organization/user/invitation/resend/email")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.user.putresendcancelinvitation({
            action: "resend",
            email: "email",
        });
        expect(response).toEqual({
            credit_notes: ["TEST-123"],
            status: "OK",
        });
    });

    test("putresendcancelinvitation (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/organization/user/invitation/resend/email")
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.user.putresendcancelinvitation({
                action: "resend",
                email: "email",
            });
        }).rejects.toThrow(BrevoApi.ForbiddenError);
    });

    test("EditUserPermission (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { all_features_access: true, email: "inviteuser@example.com", privileges: [{}] };
        const rawResponseBody = { credit_notes: ["TEST-123"], invoice_id: "invoice_id", status: "OK" };
        server
            .mockEndpoint()
            .post("/organization/user/update/permissions")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.user.editUserPermission({
            all_features_access: true,
            email: "inviteuser@example.com",
            privileges: [{}],
        });
        expect(response).toEqual({
            credit_notes: ["TEST-123"],
            invoice_id: "invoice_id",
            status: "OK",
        });
    });

    test("EditUserPermission (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { all_features_access: true, email: "email", privileges: [{}, {}] };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/organization/user/update/permissions")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.user.editUserPermission({
                all_features_access: true,
                email: "email",
                privileges: [{}, {}],
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getUserPermission (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            email: "invitedUser@company.com",
            privileges: [
                { feature: "Email campaign", permissions: ["Create / edit / delete", "Send / schedule / suspend"] },
                { feature: "Templates", permissions: ["Create / edit / delete", "Activate / deactivate"] },
                { feature: "SMS campaign", permissions: ["Create / edit / delete", "Send / schedule / suspend"] },
                { feature: "Facebook Ads", permissions: ["Schedule / pause"] },
                { feature: "Landing pages", permissions: ["All"] },
                { feature: "Workflows", permissions: ["Create / edit / delete", "Activate / deactivate / Pause"] },
                { feature: "Contacts", permissions: ["View", "Contact forms"] },
                { feature: "SMTP & API", permissions: ["SMTP", "API Keys", "Authorized IPs"] },
                { feature: "User management", permissions: ["None"] },
                {
                    feature: "Sales Platform",
                    permissions: [
                        "Create / edit / delete owned deals and tasks",
                        "Manage deals and tasks from other users",
                        "Reports",
                        "Settings",
                    ],
                },
                { feature: "Conversations", permissions: ["None"] },
                {
                    feature: "Senders, Domains & Dedicated IPs",
                    permissions: ["Senders management", "Domains management", "Dedicated IPs management"],
                },
                { feature: "Push", permissions: ["View", "Create / edit / delete", "Send", "Settings"] },
                {
                    feature: "Companies",
                    permissions: [
                        "Create / edit / delete owned companies",
                        "Manage companies from other users",
                        "Settings",
                    ],
                },
            ],
            status: "active",
        };
        server
            .mockEndpoint()
            .get("/organization/user/email/permissions")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.user.getUserPermission({
            email: "email",
        });
        expect(response).toEqual({
            email: "invitedUser@company.com",
            privileges: [
                {
                    feature: "Email campaign",
                    permissions: ["Create / edit / delete", "Send / schedule / suspend"],
                },
                {
                    feature: "Templates",
                    permissions: ["Create / edit / delete", "Activate / deactivate"],
                },
                {
                    feature: "SMS campaign",
                    permissions: ["Create / edit / delete", "Send / schedule / suspend"],
                },
                {
                    feature: "Facebook Ads",
                    permissions: ["Schedule / pause"],
                },
                {
                    feature: "Landing pages",
                    permissions: ["All"],
                },
                {
                    feature: "Workflows",
                    permissions: ["Create / edit / delete", "Activate / deactivate / Pause"],
                },
                {
                    feature: "Contacts",
                    permissions: ["View", "Contact forms"],
                },
                {
                    feature: "SMTP & API",
                    permissions: ["SMTP", "API Keys", "Authorized IPs"],
                },
                {
                    feature: "User management",
                    permissions: ["None"],
                },
                {
                    feature: "Sales Platform",
                    permissions: [
                        "Create / edit / delete owned deals and tasks",
                        "Manage deals and tasks from other users",
                        "Reports",
                        "Settings",
                    ],
                },
                {
                    feature: "Conversations",
                    permissions: ["None"],
                },
                {
                    feature: "Senders, Domains & Dedicated IPs",
                    permissions: ["Senders management", "Domains management", "Dedicated IPs management"],
                },
                {
                    feature: "Push",
                    permissions: ["View", "Create / edit / delete", "Send", "Settings"],
                },
                {
                    feature: "Companies",
                    permissions: [
                        "Create / edit / delete owned companies",
                        "Manage companies from other users",
                        "Settings",
                    ],
                },
            ],
            status: "active",
        });
    });

    test("getUserPermission (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/organization/user/email/permissions")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.user.getUserPermission({
                email: "email",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });
});
