// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("TransactionalEmailsClient", () => {
    test("getTransacBlockedContacts (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            contacts: [
                {
                    blockedAt: "2017-05-01T12:30:00Z",
                    email: "abc@xyz.com",
                    reason: { code: "adminBlocked", message: "Admin blocked" },
                    senderEmail: "ez312@gmal.com",
                },
            ],
            count: 1,
        };
        server
            .mockEndpoint()
            .get("/smtp/blockedContacts")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.getTransacBlockedContacts();
        expect(response).toEqual({
            contacts: [
                {
                    blockedAt: "2017-05-01T12:30:00Z",
                    email: "abc@xyz.com",
                    reason: {
                        code: "adminBlocked",
                        message: "Admin blocked",
                    },
                    senderEmail: "ez312@gmal.com",
                },
            ],
            count: 1,
        });
    });

    test("getTransacBlockedContacts (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/smtp/blockedContacts")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.getTransacBlockedContacts();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("unblockOrResubscribeATransactionalContact (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/smtp/blockedContacts/email").respondWith().statusCode(200).build();

        const response = await client.transactionalEmails.unblockOrResubscribeATransactionalContact({
            email: "email",
        });
        expect(response).toEqual(undefined);
    });

    test("unblockOrResubscribeATransactionalContact (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/blockedContacts/email")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.unblockOrResubscribeATransactionalContact({
                email: "email",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("unblockOrResubscribeATransactionalContact (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/blockedContacts/email")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.unblockOrResubscribeATransactionalContact({
                email: "email",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("getBlockedDomains", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { domains: ["example.com", "testdomain.com"] };
        server
            .mockEndpoint()
            .get("/smtp/blockedDomains")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.getBlockedDomains();
        expect(response).toEqual({
            domains: ["example.com", "testdomain.com"],
        });
    });

    test("blockNewDomain (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { domain: "example.com" };

        server
            .mockEndpoint()
            .post("/smtp/blockedDomains")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.transactionalEmails.blockNewDomain({
            domain: "example.com",
        });
        expect(response).toEqual(undefined);
    });

    test("blockNewDomain (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { domain: "domain" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/smtp/blockedDomains")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.blockNewDomain({
                domain: "domain",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteBlockedDomain (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/smtp/blockedDomains/domain").respondWith().statusCode(200).build();

        const response = await client.transactionalEmails.deleteBlockedDomain({
            domain: "domain",
        });
        expect(response).toEqual(undefined);
    });

    test("deleteBlockedDomain (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/blockedDomains/domain")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteBlockedDomain({
                domain: "domain",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteBlockedDomain (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/blockedDomains/domain")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteBlockedDomain({
                domain: "domain",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("deleteHardbounces (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server
            .mockEndpoint()
            .post("/smtp/deleteHardbounces")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.transactionalEmails.deleteHardbounces();
        expect(response).toEqual(undefined);
    });

    test("deleteHardbounces (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/smtp/deleteHardbounces")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteHardbounces();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("sendTransacEmail (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            htmlContent:
                "<html><head></head><body><p>Hello,</p>This is my first transactional email sent from Brevo.</p></body></html>",
            sender: { email: "hello@brevo.com", name: "Alex from Brevo" },
            subject: "Hello from Brevo!",
            to: [{ email: "johndoe@example.com", name: "John Doe" }],
        };
        const rawResponseBody = { messageId: "<201798300811.5787683@relay.domain.com>", messageIds: ["messageIds"] };
        server
            .mockEndpoint()
            .post("/smtp/email")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.sendTransacEmail({
            htmlContent:
                "<html><head></head><body><p>Hello,</p>This is my first transactional email sent from Brevo.</p></body></html>",
            sender: {
                email: "hello@brevo.com",
                name: "Alex from Brevo",
            },
            subject: "Hello from Brevo!",
            to: [
                {
                    email: "johndoe@example.com",
                    name: "John Doe",
                },
            ],
        });
        expect(response).toEqual({
            messageId: "<201798300811.5787683@relay.domain.com>",
            messageIds: ["messageIds"],
        });
    });

    test("sendTransacEmail (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            htmlContent:
                "<html><head></head><body>Your delivery is expected {{params.estimatedArrival}}.Your tracking code: {{params.trackingCode}}</p></body></html>",
            params: { trackingCode: "JD01460000300002350000", estimatedArrival: "Tomorrow" },
            sender: { email: "hello@brevo.com", name: "Alex from Brevo" },
            subject: "Hello from Brevo!",
            to: [{ email: "johndoe@example.com", name: "John Doe" }],
        };
        const rawResponseBody = { messageId: "<201798300811.5787683@relay.domain.com>", messageIds: ["messageIds"] };
        server
            .mockEndpoint()
            .post("/smtp/email")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.sendTransacEmail({
            htmlContent:
                "<html><head></head><body>Your delivery is expected {{params.estimatedArrival}}.Your tracking code: {{params.trackingCode}}</p></body></html>",
            params: {
                trackingCode: "JD01460000300002350000",
                estimatedArrival: "Tomorrow",
            },
            sender: {
                email: "hello@brevo.com",
                name: "Alex from Brevo",
            },
            subject: "Hello from Brevo!",
            to: [
                {
                    email: "johndoe@example.com",
                    name: "John Doe",
                },
            ],
        });
        expect(response).toEqual({
            messageId: "<201798300811.5787683@relay.domain.com>",
            messageIds: ["messageIds"],
        });
    });

    test("sendTransacEmail (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/smtp/email")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.sendTransacEmail();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteScheduledEmailById (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server
            .mockEndpoint()
            .delete("/smtp/email/4320f270-a4e3-4a2e-b591-edfe30a5e627")
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.transactionalEmails.deleteScheduledEmailById({
            identifier: "4320f270-a4e3-4a2e-b591-edfe30a5e627",
        });
        expect(response).toEqual(undefined);
    });

    test("deleteScheduledEmailById (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/email/identifier")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteScheduledEmailById({
                identifier: "identifier",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteScheduledEmailById (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/email/identifier")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteScheduledEmailById({
                identifier: "identifier",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("getScheduledEmailById (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            batches: [
                { createdAt: "2022-02-26T11:36:43Z", scheduledAt: "2022-02-28T11:36:43Z", status: "queued" },
                { createdAt: "2022-02-24T11:36:43Z", scheduledAt: "2022-02-25T11:36:43Z", status: "processed" },
                { createdAt: "2022-02-25T11:36:43Z", scheduledAt: "2022-02-26T11:36:43Z", status: "inProgress" },
            ],
            count: 3,
        };
        server
            .mockEndpoint()
            .get("/smtp/emailStatus/4320f270-a4e3-4a2e-b591-edfe30a5e627")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.getScheduledEmailById({
            identifier: "4320f270-a4e3-4a2e-b591-edfe30a5e627",
            startDate: "2022-02-02",
            endDate: "2022-03-02",
        });
        expect(response).toEqual({
            batches: [
                {
                    createdAt: "2022-02-26T11:36:43Z",
                    scheduledAt: "2022-02-28T11:36:43Z",
                    status: "queued",
                },
                {
                    createdAt: "2022-02-24T11:36:43Z",
                    scheduledAt: "2022-02-25T11:36:43Z",
                    status: "processed",
                },
                {
                    createdAt: "2022-02-25T11:36:43Z",
                    scheduledAt: "2022-02-26T11:36:43Z",
                    status: "inProgress",
                },
            ],
            count: 3,
        });
    });

    test("getScheduledEmailById (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            createdAt: "2022-02-26T11:36:43Z",
            scheduledAt: "2022-02-28T11:36:43Z",
            status: "queued",
        };
        server
            .mockEndpoint()
            .get("/smtp/emailStatus/4320f270-a4e3-4a2e-b591-edfe30a5e627")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.getScheduledEmailById({
            identifier: "4320f270-a4e3-4a2e-b591-edfe30a5e627",
            startDate: "2022-02-02",
            endDate: "2022-03-02",
        });
        expect(response).toEqual({
            createdAt: "2022-02-26T11:36:43Z",
            scheduledAt: "2022-02-28T11:36:43Z",
            status: "queued",
        });
    });

    test("getScheduledEmailById (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/smtp/emailStatus/identifier")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.getScheduledEmailById({
                identifier: "identifier",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getScheduledEmailById (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/smtp/emailStatus/identifier")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.getScheduledEmailById({
                identifier: "identifier",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("getTransacEmailsList (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            count: 120,
            transactionalEmails: [
                {
                    date: "2019-05-25T11:53:26Z",
                    email: "abc@xyz.com",
                    from: "diana.doe@example.com",
                    messageId: "<201798300811.5787683@relay.domain.com>",
                    subject: "summer camp",
                    tags: ["tag1"],
                    templateId: 15,
                    uuid: "5a78c-209ok98262910-std2341",
                },
                {
                    date: "2019-05-25T07:28:11Z",
                    email: "test@test.com",
                    from: "diana.doe@example.com",
                    messageId: "<201798300811.5700093@relay.domain.com>",
                    subject: "details verification",
                    tags: ["tag1"],
                    templateId: 15,
                    uuid: "5a78c-209ok98262910-s99a341",
                },
            ],
        };
        server.mockEndpoint().get("/smtp/emails").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.transactionalEmails.getTransacEmailsList();
        expect(response).toEqual({
            count: 120,
            transactionalEmails: [
                {
                    date: "2019-05-25T11:53:26Z",
                    email: "abc@xyz.com",
                    from: "diana.doe@example.com",
                    messageId: "<201798300811.5787683@relay.domain.com>",
                    subject: "summer camp",
                    tags: ["tag1"],
                    templateId: 15,
                    uuid: "5a78c-209ok98262910-std2341",
                },
                {
                    date: "2019-05-25T07:28:11Z",
                    email: "test@test.com",
                    from: "diana.doe@example.com",
                    messageId: "<201798300811.5700093@relay.domain.com>",
                    subject: "details verification",
                    tags: ["tag1"],
                    templateId: 15,
                    uuid: "5a78c-209ok98262910-s99a341",
                },
            ],
        });
    });

    test("getTransacEmailsList (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/smtp/emails").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.transactionalEmails.getTransacEmailsList();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getTransacEmailContent", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            attachmentCount: 2,
            body: "<!DOCTYPE html> <html> <body> <h1>Greetings from the team</h1> <p>This is the actual html content sent</p> </body> </html>",
            date: "2016-02-25T11:53:26Z",
            email: "abc@example.com",
            events: [
                { name: "sent", time: "2016-02-25T11:53:26Z" },
                { name: "delivered", time: "2016-02-25T11:55:26Z" },
                { name: "opened", time: "2016-02-26T09:53:26Z" },
            ],
            subject: "Summer Camps",
            templateId: 12,
        };
        server.mockEndpoint().get("/smtp/emails/uuid").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.transactionalEmails.getTransacEmailContent({
            uuid: "uuid",
        });
        expect(response).toEqual({
            attachmentCount: 2,
            body: "<!DOCTYPE html> <html> <body> <h1>Greetings from the team</h1> <p>This is the actual html content sent</p> </body> </html>",
            date: "2016-02-25T11:53:26Z",
            email: "abc@example.com",
            events: [
                {
                    name: "sent",
                    time: "2016-02-25T11:53:26Z",
                },
                {
                    name: "delivered",
                    time: "2016-02-25T11:55:26Z",
                },
                {
                    name: "opened",
                    time: "2016-02-26T09:53:26Z",
                },
            ],
            subject: "Summer Camps",
            templateId: 12,
        });
    });

    test("deleteAnSmtpTransactionalLog (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/smtp/log/identifier").respondWith().statusCode(200).build();

        const response = await client.transactionalEmails.deleteAnSmtpTransactionalLog({
            identifier: "identifier",
        });
        expect(response).toEqual(undefined);
    });

    test("deleteAnSmtpTransactionalLog (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/log/identifier")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteAnSmtpTransactionalLog({
                identifier: "identifier",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteAnSmtpTransactionalLog (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/log/identifier")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteAnSmtpTransactionalLog({
                identifier: "identifier",
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("getAggregatedSmtpReport (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            blocked: 2,
            clicks: 9987,
            delivered: 18996,
            hardBounces: 234,
            invalid: 0,
            opens: 17654,
            range: "2016-09-08|2017-04-28",
            requests: 19887,
            softBounces: 1533,
            spamReports: 1,
            uniqueClicks: 8766,
            uniqueOpens: 13688,
            unsubscribed: 2,
        };
        server
            .mockEndpoint()
            .get("/smtp/statistics/aggregatedReport")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.getAggregatedSmtpReport();
        expect(response).toEqual({
            blocked: 2,
            clicks: 9987,
            delivered: 18996,
            hardBounces: 234,
            invalid: 0,
            opens: 17654,
            range: "2016-09-08|2017-04-28",
            requests: 19887,
            softBounces: 1533,
            spamReports: 1,
            uniqueClicks: 8766,
            uniqueOpens: 13688,
            unsubscribed: 2,
        });
    });

    test("getAggregatedSmtpReport (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/smtp/statistics/aggregatedReport")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.getAggregatedSmtpReport();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getEmailEventReport (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            events: [
                {
                    date: "2017-03-12T12:30:00Z",
                    email: "john.smith@example.com",
                    event: "deferred",
                    from: "john@example.com",
                    ip: "165.87.3.15",
                    link: "https://www.someexamplelink.com",
                    messageId: "<201798300811.5787683@example.domain.com>",
                    reason: "Error connection timeout",
                    subject: "Sib client_dev test",
                    tag: "OrderConfirmation",
                    templateId: 4,
                },
                {
                    date: "2017-03-13T16:30:00Z",
                    email: "john.smith@example.com",
                    event: "delivered",
                    from: "john@example.com",
                    ip: "165.87.3.15",
                    link: "https://www.someexamplelink.com",
                    messageId: "<201798300811.5787683@example.domain.com>",
                    reason: "Error connection timeout",
                    subject: "Sib client_dev test",
                    tag: "OrderConfirmation",
                    templateId: 5,
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/smtp/statistics/events")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.getEmailEventReport();
        expect(response).toEqual({
            events: [
                {
                    date: "2017-03-12T12:30:00Z",
                    email: "john.smith@example.com",
                    event: "deferred",
                    from: "john@example.com",
                    ip: "165.87.3.15",
                    link: "https://www.someexamplelink.com",
                    messageId: "<201798300811.5787683@example.domain.com>",
                    reason: "Error connection timeout",
                    subject: "Sib client_dev test",
                    tag: "OrderConfirmation",
                    templateId: 4,
                },
                {
                    date: "2017-03-13T16:30:00Z",
                    email: "john.smith@example.com",
                    event: "delivered",
                    from: "john@example.com",
                    ip: "165.87.3.15",
                    link: "https://www.someexamplelink.com",
                    messageId: "<201798300811.5787683@example.domain.com>",
                    reason: "Error connection timeout",
                    subject: "Sib client_dev test",
                    tag: "OrderConfirmation",
                    templateId: 5,
                },
            ],
        });
    });

    test("getEmailEventReport (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/smtp/statistics/events")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.getEmailEventReport();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getSmtpReport (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            reports: [
                {
                    blocked: 519,
                    clicks: 1026,
                    date: "2017-04-30",
                    delivered: 10103,
                    hardBounces: 21,
                    invalid: 1,
                    opens: 5091,
                    requests: 10756,
                    softBounces: 137,
                    spamReports: 0,
                    uniqueClicks: 720,
                    uniqueOpens: 2318,
                    unsubscribed: 0,
                },
                {
                    blocked: 920,
                    clicks: 1514,
                    date: "2017-05-01",
                    delivered: 17499,
                    hardBounces: 34,
                    invalid: 2,
                    opens: 10089,
                    requests: 18812,
                    softBounces: 254,
                    spamReports: 0,
                    uniqueClicks: 1090,
                    uniqueOpens: 4393,
                    unsubscribed: 3,
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/smtp/statistics/reports")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.getSmtpReport();
        expect(response).toEqual({
            reports: [
                {
                    blocked: 519,
                    clicks: 1026,
                    date: "2017-04-30",
                    delivered: 10103,
                    hardBounces: 21,
                    invalid: 1,
                    opens: 5091,
                    requests: 10756,
                    softBounces: 137,
                    spamReports: 0,
                    uniqueClicks: 720,
                    uniqueOpens: 2318,
                    unsubscribed: 0,
                },
                {
                    blocked: 920,
                    clicks: 1514,
                    date: "2017-05-01",
                    delivered: 17499,
                    hardBounces: 34,
                    invalid: 2,
                    opens: 10089,
                    requests: 18812,
                    softBounces: 254,
                    spamReports: 0,
                    uniqueClicks: 1090,
                    uniqueOpens: 4393,
                    unsubscribed: 3,
                },
            ],
        });
    });

    test("getSmtpReport (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/smtp/statistics/reports")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.getSmtpReport();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("postPreviewSmtpEmailTemplates (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { key: "value" };
        const rawResponseBody = {
            fromEmail: "fromEmail",
            fromName: "fromName",
            html: "html",
            previewText: "previewText",
            subject: "subject",
            usedFeedNames: ["usedFeedNames", "usedFeedNames"],
        };
        server
            .mockEndpoint()
            .post("/smtp/template/preview")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.postPreviewSmtpEmailTemplates({
            key: "value",
        });
        expect(response).toEqual({
            fromEmail: "fromEmail",
            fromName: "fromName",
            html: "html",
            previewText: "previewText",
            subject: "subject",
            usedFeedNames: ["usedFeedNames", "usedFeedNames"],
        });
    });

    test("postPreviewSmtpEmailTemplates (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { key: "value" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/smtp/template/preview")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.postPreviewSmtpEmailTemplates({
                key: "value",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getSmtpTemplates (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            count: 2,
            templates: [
                {
                    createdAt: "2016-02-24T14:44:24Z",
                    doiTemplate: false,
                    htmlContent: "HTML CONTENT 1",
                    id: 5,
                    isActive: false,
                    modifiedAt: "2016-02-24T15:37:11Z",
                    name: "ChristomasTimeTemplate",
                    replyTo: "replyto@domain.com",
                    sender: { email: "john.smith@example.com", id: "43", name: "John" },
                    subject: "Merry Christmas",
                    tag: "Festival",
                    testSent: false,
                    toField: "",
                },
                {
                    createdAt: "2016-02-25T11:53:26Z",
                    doiTemplate: false,
                    htmlContent: "HTML CONTENT 2",
                    id: 12,
                    isActive: true,
                    modifiedAt: "2016-02-25T11:53:26Z",
                    name: "SummerSales2017Template",
                    replyTo: "replyto@domain.com",
                    sender: { email: "john.smith@example.com", id: "43", name: "John" },
                    subject: "Enjoy our summer Sales !",
                    tag: "Summer",
                    testSent: false,
                    toField: "",
                },
            ],
        };
        server.mockEndpoint().get("/smtp/templates").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.transactionalEmails.getSmtpTemplates();
        expect(response).toEqual({
            count: 2,
            templates: [
                {
                    createdAt: "2016-02-24T14:44:24Z",
                    doiTemplate: false,
                    htmlContent: "HTML CONTENT 1",
                    id: 5,
                    isActive: false,
                    modifiedAt: "2016-02-24T15:37:11Z",
                    name: "ChristomasTimeTemplate",
                    replyTo: "replyto@domain.com",
                    sender: {
                        email: "john.smith@example.com",
                        id: "43",
                        name: "John",
                    },
                    subject: "Merry Christmas",
                    tag: "Festival",
                    testSent: false,
                    toField: "",
                },
                {
                    createdAt: "2016-02-25T11:53:26Z",
                    doiTemplate: false,
                    htmlContent: "HTML CONTENT 2",
                    id: 12,
                    isActive: true,
                    modifiedAt: "2016-02-25T11:53:26Z",
                    name: "SummerSales2017Template",
                    replyTo: "replyto@domain.com",
                    sender: {
                        email: "john.smith@example.com",
                        id: "43",
                        name: "John",
                    },
                    subject: "Enjoy our summer Sales !",
                    tag: "Summer",
                    testSent: false,
                    toField: "",
                },
            ],
        });
    });

    test("getSmtpTemplates (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server.mockEndpoint().get("/smtp/templates").respondWith().statusCode(400).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.transactionalEmails.getSmtpTemplates();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("createSmtpTemplate (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            sender: {},
            subject: "Thanks for your purchase !",
            templateName: "Order Confirmation - EN",
        };
        const rawResponseBody = { id: 5 };
        server
            .mockEndpoint()
            .post("/smtp/templates")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.createSmtpTemplate({
            sender: {},
            subject: "Thanks for your purchase !",
            templateName: "Order Confirmation - EN",
        });
        expect(response).toEqual({
            id: 5,
        });
    });

    test("createSmtpTemplate (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { sender: {}, subject: "subject", templateName: "templateName" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/smtp/templates")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.createSmtpTemplate({
                sender: {},
                subject: "subject",
                templateName: "templateName",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getSmtpTemplate (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            createdAt: "2016-02-25T11:53:26Z",
            doiTemplate: false,
            htmlContent: "HTML CONTENT 4",
            id: 33,
            isActive: true,
            modifiedAt: "2016-02-25T11:53:26Z",
            name: "OrderConfirmation",
            replyTo: "replyto@domain.com",
            sender: { email: "john.smith@example.com", id: "43", name: "John" },
            subject: "Order Confirmation : Thanks for your Purchase !",
            tag: "",
            testSent: false,
            toField: "",
        };
        server
            .mockEndpoint()
            .get("/smtp/templates/1000000")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalEmails.getSmtpTemplate({
            templateId: 1000000,
        });
        expect(response).toEqual({
            createdAt: "2016-02-25T11:53:26Z",
            doiTemplate: false,
            htmlContent: "HTML CONTENT 4",
            id: 33,
            isActive: true,
            modifiedAt: "2016-02-25T11:53:26Z",
            name: "OrderConfirmation",
            replyTo: "replyto@domain.com",
            sender: {
                email: "john.smith@example.com",
                id: "43",
                name: "John",
            },
            subject: "Order Confirmation : Thanks for your Purchase !",
            tag: "",
            testSent: false,
            toField: "",
        });
    });

    test("getSmtpTemplate (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/smtp/templates/1000000")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.getSmtpTemplate({
                templateId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getSmtpTemplate (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/smtp/templates/1000000")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.getSmtpTemplate({
                templateId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("updateSmtpTemplate (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server
            .mockEndpoint()
            .put("/smtp/templates/1000000")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.transactionalEmails.updateSmtpTemplate({
            templateId: 1000000,
        });
        expect(response).toEqual(undefined);
    });

    test("updateSmtpTemplate (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/smtp/templates/1000000")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.updateSmtpTemplate({
                templateId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("updateSmtpTemplate (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .put("/smtp/templates/1000000")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.updateSmtpTemplate({
                templateId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("deleteSmtpTemplate (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/smtp/templates/1000000").respondWith().statusCode(200).build();

        const response = await client.transactionalEmails.deleteSmtpTemplate({
            templateId: 1000000,
        });
        expect(response).toEqual(undefined);
    });

    test("deleteSmtpTemplate (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/templates/1000000")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteSmtpTemplate({
                templateId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("deleteSmtpTemplate (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/smtp/templates/1000000")
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.deleteSmtpTemplate({
                templateId: 1000000,
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });

    test("sendTestTemplate (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};

        server
            .mockEndpoint()
            .post("/smtp/templates/1000000/sendTest")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .build();

        const response = await client.transactionalEmails.sendTestTemplate({
            templateId: 1000000,
            body: {},
        });
        expect(response).toEqual(undefined);
    });

    test("sendTestTemplate (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/smtp/templates/1000000/sendTest")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.sendTestTemplate({
                templateId: 1000000,
                body: {},
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("sendTestTemplate (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {};
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/smtp/templates/1000000/sendTest")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(404)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalEmails.sendTestTemplate({
                templateId: 1000000,
                body: {},
            });
        }).rejects.toThrow(BrevoApi.NotFoundError);
    });
});
