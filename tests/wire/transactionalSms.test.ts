// This file was auto-generated by Fern from our API Definition.

import * as BrevoApi from "../../src/api/index";
import { BrevoApiClient } from "../../src/Client";
import { mockServerPool } from "../mock-server/MockServerPool";

describe("TransactionalSmsClient", () => {
    test("sendAsyncTransactionalSms (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { recipient: "33689965433", sender: "MyShop" };
        const rawResponseBody = { messageId: 1511882900176220 };
        server
            .mockEndpoint()
            .post("/transactionalSMS/send")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalSms.sendAsyncTransactionalSms({
            recipient: "33689965433",
            sender: "MyShop",
        });
        expect(response).toEqual({
            messageId: 1511882900176220,
        });
    });

    test("sendAsyncTransactionalSms (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { recipient: "recipient", sender: "sender" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/transactionalSMS/send")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalSms.sendAsyncTransactionalSms({
                recipient: "recipient",
                sender: "sender",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("sendTransacSms (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { recipient: "33689965433", sender: "MyShop" };
        const rawResponseBody = {
            messageId: 1511882900176220,
            reference: "ab1cde2fgh3i4jklmno",
            remainingCredits: 82.85,
            smsCount: 2,
            usedCredits: 0.7,
        };
        server
            .mockEndpoint()
            .post("/transactionalSMS/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalSms.sendTransacSms({
            recipient: "33689965433",
            sender: "MyShop",
        });
        expect(response).toEqual({
            messageId: 1511882900176220,
            reference: "ab1cde2fgh3i4jklmno",
            remainingCredits: 82.85,
            smsCount: 2,
            usedCredits: 0.7,
        });
    });

    test("sendTransacSms (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { recipient: "recipient", sender: "sender" };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/transactionalSMS/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalSms.sendTransacSms({
                recipient: "recipient",
                sender: "sender",
            });
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("sendTransacSms (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { recipient: "recipient", sender: "sender" };
        const rawResponseBody = { message: "message" };
        server
            .mockEndpoint()
            .post("/transactionalSMS/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(402)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalSms.sendTransacSms({
                recipient: "recipient",
                sender: "sender",
            });
        }).rejects.toThrow(BrevoApi.PaymentRequiredError);
    });

    test("getTransacAggregatedSmsReport (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            accepted: 6,
            blocked: 4,
            delivered: 16,
            hardBounces: 5,
            range: "2015-05-22|2017-11-29",
            rejected: 14,
            replied: 8,
            requests: 54,
            skipped: 1,
            softBounces: 26,
            unsubscribed: 10,
        };
        server
            .mockEndpoint()
            .get("/transactionalSMS/statistics/aggregatedReport")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalSms.getTransacAggregatedSmsReport();
        expect(response).toEqual({
            accepted: 6,
            blocked: 4,
            delivered: 16,
            hardBounces: 5,
            range: "2015-05-22|2017-11-29",
            rejected: 14,
            replied: 8,
            requests: 54,
            skipped: 1,
            softBounces: 26,
            unsubscribed: 10,
        });
    });

    test("getTransacAggregatedSmsReport (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/transactionalSMS/statistics/aggregatedReport")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalSms.getTransacAggregatedSmsReport();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getSmsEvents (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            events: [
                {
                    date: "2015-05-20T12:30:00Z",
                    event: "sent",
                    messageId: "1473139351170140",
                    phoneNumber: "phoneNumber",
                    reason: "Recipient is currently unreachable",
                    reply: "reply",
                    tag: "cabWaiting",
                },
                {
                    date: "2015-05-20T16:30:00Z",
                    event: "delivered",
                    messageId: "1473139351170140",
                    phoneNumber: "phoneNumber",
                    reason: "Recipient is currently unreachable",
                    reply: "reply",
                    tag: "cabRequest",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/transactionalSMS/statistics/events")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalSms.getSmsEvents();
        expect(response).toEqual({
            events: [
                {
                    date: "2015-05-20T12:30:00Z",
                    event: "sent",
                    messageId: "1473139351170140",
                    phoneNumber: "phoneNumber",
                    reason: "Recipient is currently unreachable",
                    reply: "reply",
                    tag: "cabWaiting",
                },
                {
                    date: "2015-05-20T16:30:00Z",
                    event: "delivered",
                    messageId: "1473139351170140",
                    phoneNumber: "phoneNumber",
                    reason: "Recipient is currently unreachable",
                    reply: "reply",
                    tag: "cabRequest",
                },
            ],
        });
    });

    test("getSmsEvents (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/transactionalSMS/statistics/events")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalSms.getSmsEvents();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });

    test("getTransacSmsReport (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            reports: [
                {
                    accepted: 2318,
                    blocked: 1026,
                    date: "2017-04-30",
                    delivered: 10103,
                    hardBounces: 21,
                    rejected: 0,
                    replied: 5091,
                    requests: 10756,
                    skipped: 1,
                    softBounces: 137,
                    unsubscribed: 720,
                },
                {
                    accepted: 4393,
                    blocked: 1514,
                    date: "2017-05-01",
                    delivered: 17499,
                    hardBounces: 34,
                    rejected: 0,
                    replied: 10089,
                    requests: 18812,
                    skipped: 0,
                    softBounces: 254,
                    unsubscribed: 1090,
                },
                {
                    accepted: 4689,
                    blocked: 1646,
                    date: "2017-05-02",
                    delivered: 13427,
                    hardBounces: 16,
                    rejected: 0,
                    replied: 11563,
                    requests: 14321,
                    skipped: 1,
                    softBounces: 176,
                    unsubscribed: 1170,
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/transactionalSMS/statistics/reports")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.transactionalSms.getTransacSmsReport();
        expect(response).toEqual({
            reports: [
                {
                    accepted: 2318,
                    blocked: 1026,
                    date: "2017-04-30",
                    delivered: 10103,
                    hardBounces: 21,
                    rejected: 0,
                    replied: 5091,
                    requests: 10756,
                    skipped: 1,
                    softBounces: 137,
                    unsubscribed: 720,
                },
                {
                    accepted: 4393,
                    blocked: 1514,
                    date: "2017-05-01",
                    delivered: 17499,
                    hardBounces: 34,
                    rejected: 0,
                    replied: 10089,
                    requests: 18812,
                    skipped: 0,
                    softBounces: 254,
                    unsubscribed: 1090,
                },
                {
                    accepted: 4689,
                    blocked: 1646,
                    date: "2017-05-02",
                    delivered: 13427,
                    hardBounces: 16,
                    rejected: 0,
                    replied: 11563,
                    requests: 14321,
                    skipped: 1,
                    softBounces: 176,
                    unsubscribed: 1170,
                },
            ],
        });
    });

    test("getTransacSmsReport (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new BrevoApiClient({ maxRetries: 0, apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .get("/transactionalSMS/statistics/reports")
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.transactionalSms.getTransacSmsReport();
        }).rejects.toThrow(BrevoApi.BadRequestError);
    });
});
